name: レントゲンカルテ
description: レントゲン撮影後のカルテ作成（外来）
version: "1.3"

# 対象URL（変数展開あり）
target_url: "https://homis.jp/homic/?pid=patient_detail&patient_id={homisId}"

# 認証設定
auth:
  type: homis
  detect_login: true

# 操作ステップ（homis_writerと同じセレクタを使用）
steps:
  - name: 新規ボタンをクリック
    action: click
    selector: "#karteNew"
    wait_after: 2000

  - name: 外来を選択
    action: click
    selector: "label"
    text_contains: "外来"
    wait_after: 1000

  - name: 指示医を選択
    action: select
    selector: "#doctor018"
    value: "{doctorName}"
    wait_after: 1000

  - name: 医科カルテボタンをクリック
    action: click
    selector_type: xpath
    selector: "//a[contains(text(), '医科カルテ')]"
    wait_after: 3000

  - name: 診察日を入力
    action: js_input
    selector: "#act_date"
    value: "{shootingDate}"
    wait_after: 500

  - name: 開始時間を入力
    action: input
    selector: "#start_time"
    value: "{shootingTime}"
    wait_after: 500

  - name: 終了時間を入力
    action: input
    selector: "#end_time"
    value: "{shootingTimeEnd}"
    wait_after: 2000

  - name: S欄に入力
    action: js_input
    selector: "textarea#subjective"
    value: "{sContent}"
    wait_after: 2000

  - name: A/P Summary欄に入力
    action: js_input
    selector: "textarea#ap"
    value: "{apContent}"
    wait_after: 2000

  - name: 中断ボタンで保存
    action: click
    selector: "#karteInterruption"
    confirm_alert: true
    wait_after: 5000

# 完了後の処理
on_complete:
  - name: リンクをコピー
    action: click
    selector_type: xpath
    selector: "//a[contains(@onclick, 'copyLinkOfKarte')]"
    wait_after: 1000

# 結果の取得
result:
  type: clipboard
  description: カルテURL
